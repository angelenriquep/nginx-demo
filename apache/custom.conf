<VirtualHost *:80>
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        AllowOverride All
        Require all granted
    </Directory>

    # Suppress FQDN warning
    ServerName localhost

    # Secret header check
    <If "%{HTTP:X-Secret} != 'super-secret-key'">
        Require all denied
    </If>

    # Variant routing logic
    SetEnvIf X-Variant "A" is_variant_a
    SetEnvIf X-Variant "B" is_variant_b

    Header always set X-Variant-Received "%{HTTP:X-Variant}e"

    RewriteEngine On
    RewriteCond %{ENV:is_variant_a} =1
    RewriteRule ^/$ /variant_a/index.html [L]

    RewriteCond %{ENV:is_variant_b} =1
    RewriteRule ^/$ /variant_b/index.html [L]

    ErrorDocument 403 "Forbidden - Missing or incorrect X-Secret header"
</VirtualHost>
